function activate_license(){$.ajax({type:"GET",async:true,url:"https://www.appnitro.com/licensemanager/activate.php",data:{install_url:window.location.href,license_key:$("#license_box").data("licensekey")},cache:false,global:true,dataType:"jsonp",error:function(c,a,b){},success:function(a){$("#dialog-change-license").dialog("close");$("#dialog-change-license-btn-save-changes").prop("disabled",false);$("#dialog-change-license-btn-save-changes").text("Activate New License");if(a.status=="invalid_key"||a.status=="usage_exceed"){alert(a.message);$("#lic_activate").hide();$("#unregisted_holder").text("UNREGISTERED LICENSE");$("#lic_type").text("Invalid License");$("#lic_customer_id").text("-");$("#lic_customer_name").text("-");$.ajax({type:"POST",async:true,url:"unregister.php",data:{unregister:"1"},cache:false,global:false,dataType:"json",error:function(d,b,c){},success:function(b){}})}else{if(a.status=="valid_key"){$("#lic_customer_id").text(a.customer_id);$("#lic_customer_name").text(a.customer_name);$("#lic_activate").hide();$("#unregisted_holder").text("");$("#lic_type").text(a.license_type);$.ajax({type:"POST",async:true,url:"register.php",data:{customer_name:a.customer_name,customer_id:a.customer_id,license_key:$("#license_box").data("licensekey")},cache:false,global:false,dataType:"json",error:function(d,b,c){},success:function(b){}})}}}})}function version_compare(g,f,j){var h=j&&j.lexicographical,d=j&&j.zeroExtend,b=g.split("."),e=f.split(".");function a(i){return(h?/^\d+[A-Za-z]*$/:/^\d+$/).test(i)}if(!b.every(a)||!e.every(a)){return NaN}if(d){while(b.length<e.length){b.push("0")}while(e.length<b.length){e.push("0")}}if(!h){b=b.map(Number);e=e.map(Number)}for(var c=0;c<b.length;++c){if(e.length==c){return 1}if(b[c]==e[c]){continue}else{if(b[c]>e[c]){return 1}else{return -1}}}if(b.length!=e.length){return -1}return 0}$(function(){$(".helpmsg").tooltip({position:"bottom center",offset:[10,20],effect:"fade",opacity:0.8,events:{def:"click,mouseout"}});$("#smtp_enable").click(function(){if($(this).prop("checked")==true){$("#ms_box_smtp .ms_box_email").slideDown()}else{$("#ms_box_smtp .ms_box_email").slideUp()}});$("#more_option_misc_settings").click(function(){if($(this).text()=="advanced options"){$("#ms_box_misc .ms_box_more").slideDown();$(this).text("hide options");$("#misc_settings_img_arrow").attr("src","images/icons/38_topred_16.png")}else{$("#ms_box_misc .ms_box_more").slideUp();$(this).text("advanced options");$("#misc_settings_img_arrow").attr("src","images/icons/38_rightred_16.png")}return false});$("#enable_ip_restriction").click(function(){if($(this).prop("checked")==true){$("#div_ip_whitelist").slideDown()}else{$("#div_ip_whitelist").slideUp()}});$("#enable_account_locking").click(function(){if($(this).prop("checked")==true){$("#div_account_locking").slideDown()}else{$("#div_account_locking").slideUp()}});$("#button_save_main_settings").click(function(){if($("#button_save_main_settings").text()!="Saving..."){$("#button_save_main_settings").prop("disabled",true);$("#button_save_main_settings").text("Saving...");$("#button_save_main_settings").after("<img style=\"margin-left: 10px\" src='images/loader_small_grey.gif' />");$("#ms_form").submit()}return false});$("#dialog-change-license").dialog({modal:true,autoOpen:false,closeOnEscape:false,width:400,position:["center",150],draggable:false,resizable:false,buttons:[{text:"Activate New License",id:"dialog-change-license-btn-save-changes","class":"bb_button bb_small bb_green",click:function(){if($("#dialog-change-license-input").val()==""){alert("Please enter your license key!")}else{$("#dialog-change-license-btn-save-changes").prop("disabled",true);$("#dialog-change-license-btn-save-changes").text("Activating...");$("#license_box").data("licensekey",$("#dialog-change-license-input").val());activate_license()}}},{text:"Cancel",id:"dialog-change-license-btn-cancel","class":"btn_secondary_action",click:function(){$("#dialog-change-license-btn-save-changes").prop("disabled",false);$("#dialog-change-license-btn-save-changes").text("Activate New License");$(this).dialog("close")}}]});$("#ms_change_license").click(function(){$("#dialog-change-license").dialog("open");return false});$("#lic_activate").click(function(){if($(this).text()!="activating..."){$(this).text("activating...");activate_license()}return false});if($("#lic_activate").length>0){activate_license()}$("#dialog-change-license-form").submit(function(){$("#dialog-change-license-btn-save-changes").click();return false});$("#ms_btn_export_form").click(function(){var a=$("#export_form_id").val();window.location.href="export_form.php?form_id="+a});$("input[name=export_import_type]").click(function(){var a=$(this).val();$("#tab_export_form,#tab_import_form").hide();if(a=="export"){$("#tab_export_form").show()}else{if(a=="import"){$("#tab_import_form").show()}}});$("#ms_form_import_file").uploadifive({uploadScript:"import_form_uploader.php",buttonText:"Select File",removeCompleted:true,formData:{session_id:$(".main_settings").data("session_id")},auto:true,multi:false,onUploadError:function(a,d,c,b){alert("The file "+a.name+" could not be uploaded: "+b)},onUploadComplete:function(c,b){var a=false;try{var f=jQuery.parseJSON(b);a=true}catch(g){a=false;alert(b)}if(a==true&&f.status=="ok"){var d=f.file_name;$.ajax({type:"POST",async:true,url:"import_form_parser.php",data:{file_name:d},cache:false,global:false,dataType:"json",error:function(j,h,i){alert("Error while importing file. Error Message:\n"+j.responseText)},success:function(e){if(e.status=="ok"){$("#dialog-form-import-success").data("form_id",e.new_form_id);$("#dialog-form-import-success").data("form_name",e.new_form_name);$("#form-imported-link").text(e.new_form_name);$("#form-imported-link").attr("href","view.php?id="+e.new_form_id);$("#dialog-form-import-success").dialog("open")}else{if(e.status=="error"){$("#dialog-warning-msg").html(e.message)}$("#dialog-warning").dialog("open")}}})}else{alert("Error uploading file. Please try again.")}}});$("#ldap_enable").click(function(){if($(this).prop("checked")==true){$("#ms_box_ldap .ms_box_email").slideDown()}else{$("#ms_box_ldap .ms_box_email").slideUp()}});$("#dialog-form-import-success").dialog({modal:true,autoOpen:false,closeOnEscape:false,width:450,resizable:false,draggable:false,position:["center","center"],open:function(){$("#btn-form-success-done").blur()},buttons:[{text:"Done",id:"btn-form-success-done","class":"bb_button bb_small bb_green",click:function(){$(this).dialog("close")}},{text:"Edit Form",id:"btn-form-success-edit","class":"btn_secondary_action",click:function(){var a=$("#dialog-form-import-success").data("form_id");window.location.replace("edit_form.php?id="+a)}}]});$("#dialog-warning").dialog({modal:true,autoOpen:false,closeOnEscape:false,width:450,position:["center","center"],draggable:false,resizable:false,open:function(){$(this).next().find("button").blur()},buttons:[{text:"OK","class":"bb_button bb_small bb_green",click:function(){$(this).dialog("close")}}]});$("#ldap_type").bind("change",function(){var a=$(this).val();if(a=="ad"){$("#account_suffix_span").fadeIn()}else{$("#account_suffix_span").hide()}});$("#dialog-get-new-update").dialog({modal:true,autoOpen:false,closeOnEscape:false,width:400,position:["center",150],draggable:false,resizable:false,buttons:[{text:"More Details",id:"dialog-get-new-update-btn-download","class":"bb_button bb_small bb_green",click:function(){window.location.replace($("#license_box").data("update_url"))}},{text:"Later",id:"dialog-get-new-update-btn-later","class":"btn_secondary_action",click:function(){$(this).dialog("close")}}]});$("#check_update_link").click(function(){if($(this).text()=="check for updates"){$(this).text("checking for updates...");$("#check_update_loader").show()}else{return false}$.ajax({type:"GET",async:true,url:"https://www.appnitro.com/check-latest-version/",cache:false,global:true,dataType:"jsonp",error:function(c,a,b){alert("Error while checking for updates. Error Message:\n"+c.responseText)},success:function(c){var a=String($("#license_box").data("machformversion"));var b=c.latest_version;if(version_compare(a,b)<0){$("#latest_version_span").text(b);$("#license_box").data("update_url",c.update_url);$("#dialog-get-new-update").dialog("open")}else{alert("You're up to date! MachForm Version "+a+" is currently the newest version available.")}$("#check_update_link").text("check for updates");$("#check_update_loader").hide()}});return false})});